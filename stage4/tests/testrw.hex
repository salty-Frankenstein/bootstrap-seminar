;; put a test string here
:tstr
"hello, World!" 00

:main   ;; entry point, it starts the repl

;; initialize the Forth stack pointer
C7 C7 00400000        ;; mov edi, 0x00400000  ; point to the top of the forth stack
;; initialize file descriptors
C7 05 =fdin 00000000  ;; mov [fdin], 0      ; store in fdin
C7 05 =fdot 00000001  ;; mov [fdot], 1      ; store in fdot

;; before we reach a repl, we may test some words here

;; test ! and @, !b and @b, put-char and get-char
81 EF 00000004  ;; sub edi, 4      ; make space on stack
C7 C0 =glbl     ;; mov eax, =glbl  ; push address of a global variable
89 07           ;; mov [edi], eax  

E8 -dup      ;; call dup    (addr addr)

81 EF 00000004  ;; sub edi, 4            ; make space on stack
C7 C0 c0ffeeab  ;; mov eax, 0xc0ffeeab   ; push a 0xc0ffeeab 
89 07           ;; mov [edi], eax  (addr addr 0xc0ffeeab) 
E8 -wtad     ;; call !                   ; glbl <- 0xc0ffeeab ( addr )

E8 -dup      ;; call dup    (addr addr)
E8 -gtch     ;; call get-char  (addr addr char)        
E8 -dup      ;; call dup    (addr addr char char)
E8 -ptch     ;; call put-char  (addr addr char)

E8 -wtab     ;; call !b               ; glbl[0] <- char ( addr )
;; glbl = 0xc0ffeeab -> 0xc0ffee42

E8 -dup      ;; call dup    (addr addr)
E8 -rdab     ;; call @b               ; push glbl[0] ( addr char )
E8 -swap     ;; call swap             ; ( char addr )

E8 -rdad     ;; call @         ; ( char 0xc0ffeeab )
